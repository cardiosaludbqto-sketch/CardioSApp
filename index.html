<!DOCTYPE html>
<html>
<head>
    <title>Cardio Salud - Monitoreo PA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* Estilos generales para asegurar el fondo oscuro en todo el cuerpo */
        body {
            margin: 0;
            background-color: #1f2937;
            color: #ffffff;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
        }
        /* Estilos para asegurar que la aplicaci√≥n ocupe la altura m√≠nima de la pantalla */
        #root {
            min-height: 100vh;
            background-color: #1f2937;
        }
        /* Estilos para el bot√≥n de regreso (P√°gina 4) */
       .return-button {
            padding: 0.4rem 0.6rem; 
            font-size: 1.1rem; 
            background-color: #dc2626; 
            color: white; 
            border-radius: 50%; 
            line-height: 1; 
            border: 2px solid white; 
            width: 30px; 
            height: 30px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            margin-left: 10px;
        }
    </style>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
// =========================================================================
// === C√ìDIGO FINAL DE LA APLICACI√ìN CARDIOSALUD (P√ÅGINAS 1 A 4) ===========
// =========================================================================

const DOCTOR_PHONE = '+584245459581';
const CURRENT_DATE = new Date().toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });
const CURRENT_TIME = new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', hour12: true });

// --- L√ìGICA DE PERSISTENCIA Y ESTADO ---
const loadState = () => {
    const storedState = JSON.parse(localStorage.getItem('cardioSaludState'));
    const initialState = {
        currentPage: 1, 
        measurementCount: 0, 
        patientData: { 
            nombre: "Juan Antonio Rivas", 
            cedula: "V-10123456", 
            edad: "65", 
            historiaClinica: "J-108", 
            medicamentos: "Enalapril 10 mg OD + Amlodipina 5 mg" 
        },
        manana: { saved: false, pas: null, pad: null, pulso: null }, 
        noche: { saved: false, pas: null, pad: null, pulso: null }, 
        avgMetrics: { ps: 131, pd: 83, pulso: 70 },
        readingsHistory:, 
        isAuthReady: true,
    };
    // Prioriza el estado guardado si existe, si no, usa los valores iniciales.
    return storedState |

| initialState; 
};

// --- COMPONENTE PRINCIPAL (CONTROLADOR DE FLUJO) ---
const CardioSaludApp = () => {
    const = React.useState(loadState());

    React.useEffect(() => {
        localStorage.setItem('cardioSaludState', JSON.stringify(appState));
    },);

    const navigate = (pageNumber) => setAppState(prev => ({...prev, currentPage: pageNumber }));
    const isAppLocked = appState.measurementCount >= 28;

    // L√ìGICA: GUARDADO DE MEDICIONES (P√°gina 3)
    const handleSavePage3 = (session, newData) => {
        const { readingsHistory, measurementCount } = appState;
        
        let newCount = measurementCount + 1;
        let newHistory = [...readingsHistory];
        
        // Simular el registro de la toma
        newHistory.push({
            day: newCount,
            date: CURRENT_DATE,
            time: CURRENT_TIME,
            session: session === 'manana'? 'AM' : 'PM',
            ps: newData.pas,
            pad: newData.pad,
            pulso: newData.pulso |

| 'N/A',
        });

        if (session === 'manana') {
            setAppState(prev => ({...prev, manana: {...newData, saved: true }, measurementCount: newCount, readingsHistory: newHistory }));
            // Flujo: Ma√±ana -> Noche (queda en P3)
        } else if (session === 'noche') {
            setAppState(prev => ({ 
             ...prev, 
                noche: {...newData, saved: true },
                manana: { saved: false, pas: null, pad: null, pulso: null }, 
                noche: { saved: false, pas: null, pad: null, pulso: null },  
                measurementCount: newCount, 
                readingsHistory: newHistory,
            }));
            // Flujo: Noche -> Dashboard/Historial (P√°gina 4)
            navigate(4); 
        }
    };
    
    // L√ìGICA: REPORTE POR WHATSAPP
    const handleWhatsAppSend = () => {
        if (appState.measurementCount!== 14) return;
        
        const { patientData, avgMetrics, readingsHistory } = appState;
        
        // Generaci√≥n de la tabla de texto
        let table = "N# | Fecha | Hora | PS/PD | Pulso\n";
        table += "---|---|---|---|---\n";
        readingsHistory.slice(0, 14).forEach(r => {
            table += `${r.day} | ${r.date.substring(0, 5)} | ${r.session} | ${r.ps}/${r.pad} | ${r.pulso}\n`;
        });
        
        const message = `*REPORTE CL√çNICO CARDIOSALUD (7 D√≠as)*\n\n` + 
                        `*M√©dico:* Dr. Juan Chaar Salazar\n` +
                        `*Paciente:* ${patientData.nombre} (HC: ${patientData.historiaClinica})\n` +
                        `*Medicaci√≥n:* ${patientData.medicamentos}\n\n` +
                        `*PROMEDIOS:* PS/PD ${avgMetrics.ps}/${avgMetrics.pd} mmHg | Pulso ${avgMetrics.pulso} lpm\n\n` +
                        `*DETALLE DE 14 MEDICIONES:*\n${table}\n` +
                        `_Este reporte se genera autom√°ticamente desde la app._`;
                        
        const whatsappUrl = `https://wa.me/${DOCTOR_PHONE.replace(/[^0-9]/g, '')}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
        
        // Simular la anulaci√≥n del bot√≥n de env√≠o tras el reporte
        setAppState(prev => ({...prev, measurementCount: prev.measurementCount + 1 })); 
    };

    // --- P√ÅGINAS INDIVIDUALES ---

    // P√ÅGINA 1
    const SplashScreenView = ({ onEnterApp }) => (
        <div style={{padding: '2rem', maxWidth: '400px', margin: '0 auto', backgroundColor: '#1f2937', minHeight: '100vh', color: '#ffffff', textAlign: 'center', display: 'flex', flexDirection: 'column', justifyContent: 'center'}}>
            <h3 style={{color: '#60a5fa', fontSize: '1rem', marginBottom: '5px'}}>P√ÅGINA 1: BIENVENIDA</h3>
            <div style={{width: '150px', height: '150px', margin: '0 auto 15px', borderRadius: '50%', display: 'flex', justifyContent: 'center', alignItems: 'center', backgroundColor: '#1e3a8a', position: 'relative'}}>
                <span style={{fontSize: '3rem', color: '#b91c1c', textShadow: '0 0 10px rgba(0, 0, 0, 0.5)'}}>‚ù§Ô∏è</span>
                <p style={{position: 'absolute', top: '15px', fontSize: '0.8rem', fontWeight: '800', color: '#facc15', textTransform: 'uppercase'}}>CARDIOSALUD</p>
                <p style={{position: 'absolute', bottom: '15px', fontSize: '0.7rem', fontWeight: '800', color: '#facc15'}}>Dr. Juan Chaar Salazar</p>
            </div>
            <h1 style={{fontSize: '1.5rem', fontWeight: '800', color: '#ef4444', marginTop: '5px'}}>Cardio Salud</h1>
            <p style={{fontSize: '1rem', color: '#d1d5db', marginTop: '5px'}}>Dr. Juan Chaar Salazar</p>
            <p style={{fontSize: '0.75rem', color: '#3b82f6', marginTop: '5px'}}>Gu√≠as ACC/AHA 2025</p>
            <button onClick={onEnterApp} style={{width: '90%', padding: '12px', backgroundColor: '#10b981', color: 'white', borderRadius: '8px', margin: '30px auto 0 auto', fontWeight: '700', fontSize: '1.1rem', display: 'block'}}>
                Entrar a la Aplicaci√≥n
            </button>
        </div>
    );

    // P√ÅGINA 2
    const PatientIdentificationView = ({ data, onSave, isAuthReady }) => {
        const = React.useState(data);
        
        const handleChange = (field, value) => {
            setFormData(prev => ({...prev, [field]: value }));
        };

        const handleHcChange = (value) => {
            let cleanValue = value.toUpperCase().replace(/[^A-Z0-9-]/g, '');
            let formattedValue = '';
            if (cleanValue.length === 1 && cleanValue!== '-') {
                formattedValue = cleanValue + '-';
            } else if (cleanValue.length > 1 && cleanValue![1]== '-') {
                 formattedValue = cleanValue + '-' + cleanValue.substring(1).replace(/-/g, '');
            } else {
                formattedValue = cleanValue;
            }
            formattedValue = formattedValue.substring(0, 5);
            if (formattedValue.includes('-')) {
                const parts = formattedValue.split('-');
                const prefix = parts |

| '';
                let suffix = parts[1] |

| '';
                suffix = suffix.replace(/[^0-9]/g, '').substring(0, 3);
                formattedValue = prefix + '-' + suffix;
            }
            handleChange('historiaClinica', formattedValue);
        };
        
        const handleSubmit = () => {
            // Validaci√≥n m√≠nima
            if (!formData.nombre |

|!formData.cedula |

|!formData.edad) {
                alert('Por favor, complete Nombre, C√©dula y Edad.');
                return;
            }
            onSave(formData);
        };

        return (
            <div style={{padding: '0.75rem', maxWidth: '400px', margin: '0 auto', backgroundColor: '#1f2937', minHeight: '100vh', color: '#ffffff', boxSizing: 'border-box'}}>
                <h3 style={{color: '#f97316', fontSize: '0.9rem', marginBottom: '5px'}}>P√ÅGINA 2: IDENTIFICACI√ìN</h3>
                <h2 style={{fontSize: '1.35rem', fontWeight: '700', color: '#f3f4f6', marginBottom: '10px'}}>Identificaci√≥n del Paciente</h2>
                <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                    <label style={{fontSize: '0.75rem', color: '#d1d5db', marginBottom: '0.1rem'}}>Nombre Completo</label>
                    <input type="text" value={formData.nombre} onChange={(e) => handleChange('nombre', e.target.value)} style={{padding: '0.4rem 0.6rem', backgroundColor: '#374151', borderRadius: '0.4rem', fontSize: '0.9rem', color: '#ffffff'}} />
                    
                    <label style={{fontSize: '0.75rem', color: '#d1d5db', marginBottom: '0.1rem'}}>C√©dula de Identidad (CI)</label>
                    <input type="text" value={formData.cedula} onChange={(e) => handleChange('cedula', e.target.value.replace(/[^0-9V-]/gi, '').toUpperCase())} style={{padding: '0.4rem 0.6rem', backgroundColor: '#374151', borderRadius: '0.4rem', fontSize: '0.9rem', color: '#ffffff'}} />

                    <label style={{fontSize: '0.75rem', color: '#d1d5db', marginBottom: '0.1rem'}}>Edad</label>
                    <input type="number" value={formData.edad} onChange={(e) => handleChange('edad', e.target.value)} style={{padding: '0.4rem 0.6rem', backgroundColor: '#374151', borderRadius: '0.4rem', fontSize: '0.9rem', color: '#ffffff'}} />

                    <label style={{fontSize: '0.75rem', color: '#d1d5db', marginBottom: '0.1rem'}}>Historia Cl√≠nica (HC) - Ej: F-746 (Opcional)</label>
                    <input type="text" value={formData.historiaClinica} onChange={(e) => handleHcChange(e.target.value)} maxLength="5" style={{padding: '0.4rem 0.6rem', backgroundColor: '#374151', borderRadius: '0.4rem', fontSize: '0.9rem', color: '#ffffff', fontFamily: 'monospace', textTransform: 'uppercase'}} />
                    
                    <label style={{fontSize: '0.75rem', color: '#d1d5db', marginBottom: '0.1rem'}}>MEDICACI√ìN (Dosis y Frecuencia)</label>
                    <textarea rows="2" value={formData.medicamentos} onChange={(e) => handleChange('medicamentos', e.target.value)} style={{width: '100%', padding: '0.4rem 0.6rem', backgroundColor: '#374151', borderRadius: '0.4rem', fontSize: '0.9rem', color: '#ffffff', resize: 'none'}}></textarea>
                    
                    <button onClick={handleSubmit} style={{width: '100%', padding: '0.6rem', backgroundColor: '#22c55e', color: 'white', borderRadius: '0.5rem', marginTop: '5px', fontWeight: '700', fontSize: '1rem'}}>GUARDAR</button>
                </div>
            </div>
        );
    };

    // P√ÅGINA 3
    const DailyMeasurementSwitchView = ({ data, onSave, onSendReport, measurementCount, patientInfo, navigate }) => {
        const { manana, noche } = data;
        const = React.useState({ pas: '', pad: '', pulso: '' });

        const isMorningSaved = manana.saved;
        const isEveningSaved = noche.saved;
        const isAppLocked = measurementCount >= 28;
        const isSendButtonActive = measurementCount === 14;
        const isComplete = tempData.pas && tempData.pad;

        const handleSaveWrapper = (session) => {
            if (!isComplete) return;
            onSave(session, tempData);
            setTempData({ pas: '', pad: '', pulso: '' }); // Limpiar inputs
        };

        const MeasurementBlock = ({ session, title, isSaved }) => (
            <div style={{display: 'flex', flexDirection: 'column', padding: '0.8rem', borderRadius: '0.75rem', border: `2px solid ${session === 'manana'? '#ef4444' : '#3b82f6'}`, backgroundColor: '#374151'}}>
                <h4 style={{fontSize: '1.35rem', fontWeight: '700', color: (session === 'manana'? '#f87171' : '#60a5fa'), marginBottom: '0.75rem'}}>{title}</h4>
                <div style={{fontSize: '0.875rem', color: '#d1d5db', marginBottom: '0.75rem'}}>Fecha y Hora: <span style={{fontWeight: '700'}}>{CURRENT_DATE} - {CURRENT_TIME}</span></div>
                <p style={{fontSize: '1.125rem', fontWeight: '700', color: '#d1d5db', marginBottom: '0.5rem'}}>Valores (mmHg / lpm)</p>
                <div style={{display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '0.5rem', marginBottom: '0.75rem'}}>
                    <input type="number" placeholder="PAS" value={tempData.pas} onChange={(e) => setTempData(p => ({...p, pas: e.target.value}))} style={{padding: '0.75rem 0.5rem', fontSize: '1.75rem', backgroundColor: '#4b5563', borderRadius: '0.5rem', color: 'white', textAlign: 'center'}} />
                    <input type="number" placeholder="PAD" value={tempData.pad} onChange={(e) => setTempData(p => ({...p, pad: e.target.value}))} style={{padding: '0.75rem 0.5rem', font-size: '1.75rem', backgroundColor: '#4b5563', borderRadius: '0.5rem', color: 'white', textAlign: 'center'}} />
                    <input type="number" placeholder="Pulso (Op)" value={tempData.pulso} onChange={(e) => setTempData(p => ({...p, pulso: e.target.value}))} style={{padding: '0.75rem 0.5rem', font-size: '1.75rem', backgroundColor: '#4b5563', borderRadius: '0.5rem', color: 'white', textAlign: 'center'}} />
                </div>
                <button onClick={() => handleSaveWrapper(session)} disabled={!isComplete} style={{width: '100%', padding: '0.75rem', fontSize: '1.125rem', fontWeight: '700', color: '#ffffff', backgroundColor: '#10b981', borderRadius: '0.75rem', opacity: isComplete? '1' : '0.5'}}>GUARDAR</button>
            </div>
        );

        let contentToDisplay;
        if (isAppLocked) contentToDisplay = (<div style={{padding: '1rem', border: '2px solid #ef4444', backgroundColor: '#374151'}}><h3 style={{color: '#ef4444'}}>CONTROL CARDIL√ìGICO</h3></div>);
        else if (!isMorningSaved) contentToDisplay = <MorningBlock session="manana" title="MA√ëANA" isSaved={isMorningSaved} />;
        else if (isMorningSaved &&!isEveningSaved) contentToDisplay = <MeasurementBlock session="noche" title="TARDE/NOCHE" isSaved={isEveningSaved} />;
        else contentToDisplay = (<div style={{padding: '1rem', borderRadius: '0.75rem', border: '2px solid #10b981', backgroundColor: '#374151', textAlign: 'center'}}><span style={{fontSize: '3rem', display: 'block'}}>‚úÖ</span><h3 style={{color: '#10b981'}}>D√≠a de Registro Completo</h3><p style={{fontSize: '0.875rem'}}>Listo para ma√±ana.</p></div>);
        
        return (
            <div style={{padding: '0.75rem', maxWidth: '400px', margin: '0 auto', backgroundColor: '#1f2937', minHeight: '100vh', color: '#ffffff', boxSizing: 'border-box'}}>
                <h3 style={{color: '#ef4444', fontSize: '0.9rem', marginBottom: '5px'}}>P√ÅGINA 3: REGISTRO PA</h3>
                <h2 style={{fontSize: '1.5rem', fontWeight: '700', color: '#f3f4f6', marginBottom: '10px'}}>Registro de PA Diario</h2>
                <div style={{backgroundColor: '#1e3a8a', padding: '0.6rem', borderRadius: '0.5rem', margin: '0 0 10px 0'}}>
                    <h3 style={{fontSize: '1.0rem', color: '#93c5fd', margin: '0 0 0.2rem 0'}}>CONDICIONES DE PREPARACI√ìN</h3>
                    <p style={{fontSize: '0.8rem', color: '#d1d5db'}}>**5 Reglas Clave:** Reposo 5 min, espalda/brazo apoyados, vejiga vac√≠a, sin caf√©/alcohol 30 min.</p>
                </div>
                <p style={{fontSize: '0.875rem', color: '#9ca3af', margin: '0 0 10px 0'}}>Mediciones Registradas: {measurementCount} / 28</p>
                {contentToDisplay}
                <button onClick={handleWhatsAppSend} disabled={!isSendButtonActive |

| isAppLocked} style={{width: '100%', padding: '0.75rem', marginTop: '15px', backgroundColor: (isSendButtonActive &&!isAppLocked)? '#dc2626' : '#4b5563', color: 'white', borderRadius: '0.75rem'}}>
                    {(isSendButtonActive &&!isAppLocked)? 'üö® ENV√çO AL DOCTOR (WhatsApp)' : 'Esperando Medici√≥n #14'}
                </button>
                <p style={{textAlign: 'center', fontSize: '0.75rem', color: '#9ca3af', marginTop: '5px'}}>Faltan {14 - measurementCount} mediciones para el primer reporte de 7 d√≠as.</p>
                <button onClick={() => navigate(4)} style={{width: '100%', padding: '0.5rem', marginTop: '5px', backgroundColor: '#4b5563', color: 'white', borderRadius: '0.5rem'}}>Ver Historial (P4)</button>
            </div>
        );
    };

    // P√ÅGINA 4
    const ReportDashboardView = ({ patientInfo, measurementCount, avgMetrics, onNavigate }) => {
        const simulatedReadings = appState.readingsHistory.slice(-4); // √öltimas 4 tomas
        return (
            <div style={{padding: '0.75rem', maxWidth: '400px', margin: '0 auto', backgroundColor: '#1f2937', minHeight: '100vh', color: '#ffffff'}}>
                <h3 style={{color: '#3b82f6', fontSize: '0.9rem', marginBottom: '5px'}}>P√ÅGINA 4: HISTORIAL</h3>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}><h2 style={{fontSize: '1.5rem', fontWeight: '700', color: '#f3f4f6'}}>Historial de Monitoreo</h2><button onClick={onNavigate} className="return-button" title="Regresar al Registro">‚Üê</button></div>
                
                <div style={{fontSize: '0.875rem', color: '#9ca3af', margin: '0.25rem 0 0.75rem 0'}}>
                    <p><span style={{fontWeight: '600'}}>Paciente:</span> {patientInfo.nombre}, {patientInfo.edad} a√±os</p>
                    <p style={{fontSize: '0.75rem'}}><span style={{fontWeight: '600'}}>HC:</span> {patientInfo.historiaClinica}</p>
                    <p style={{fontSize: '0.75rem'}}><span style={{fontWeight: '600'}}>Medicaci√≥n:</span> {patientInfo.medicamentos}</p>
                </div>
                <div style={{display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '0.5rem', margin: '0 0 0.75rem 0'}}>
                    <div style={{padding: '0.4rem', border: '1px solid #f87171', borderRadius: '0.5rem', backgroundColor: '#1f2937'}}><p style={{fontSize: '0.7rem', color: '#9ca3af'}}>PS/PD Prom.</p><p style={{fontSize: '1.25rem', color: '#f87171'}}>{avgMetrics.ps}/{avgMetrics.pd}</p></div>
                    <div style={{padding: '0.4rem', border: '1px solid #ffbf00', borderRadius: '0.5rem', backgroundColor: '#1f2937'}}><p style={{fontSize: '0.7rem', color: '#9ca3af'}}>Pulso Prom.</p><p style={{fontSize: '1.25rem', color: '#ffbf00'}}>{avgMetrics.pulso} lpm</p></div>
                    <div style={{padding: '0.4rem', border: '1px solid #34d399', borderRadius: '0.5rem', backgroundColor: '#1f2937'}}><p style={{fontSize: '0.7rem', color: '#9ca3af'}}>Mediciones</p><p style={{fontSize: '1.25rem', color: '#34d399'}}>{measurementCount} / 28</p></div>
                </div>
                <h3 style={{fontSize: '1rem', fontWeight: '700', margin: '0.75rem 0 0.5rem 0', color: '#d1d5db'}}>Detalle de Mediciones (√öltimos Registros)</h3>
                <div style={{border: '1px solid #374151', borderRadius: '0.5rem', overflow: 'hidden', margin: '0 0 0.75rem 0'}}>
                    <table style={{width: '100%', fontSize: '0.75rem'}}>
                        <thead><tr style={{backgroundColor: '#374151'}}><th style={{padding: '0.3rem'}}>N#</th><th style={{padding: '0.3rem'}}>Fecha</th><th style={{padding: '0.3rem'}}>Hora</th><th style={{padding: '0.3rem'}}>PS/PD</th><th style={{padding: '0.3rem'}}>Pulso</th></tr></thead>
                        <tbody>{simulatedReadings.map((r, i) => (<tr key={i}><td style={{padding: '0.35rem'}}>{r.day}</td><td style={{padding: '0.35rem'}}>{r.date.substring(0, 5)}</td><td style={{padding: '0.35rem'}}>{r.session}</td><td style={{padding: '0.35rem'}}>{r.ps}/{r.pad}</td><td style={{padding: '0.35rem'}}>{r.pulso}</td></tr>))}</tbody>
                    </table>
                </div>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', fontSize: '0.75rem', color: '#6b7280', borderTop: '1px solid #374151', paddingTop: '0.5rem'}}>
                    <p style={{flexGrow: 1}}>Desarrollado por Dr. Juan Chaar Salazar (Gu√≠as ACC/AHA 2025)</p>
                    <button onClick={onNavigate} className="return-button" title="Regresar al Registro" style={{width: '30px', height: '30px', display: 'flex', justifyContent: 'center', alignItems: 'center', marginLeft: '10px'}}>‚Üê</button>
                </div>
            </div>
        );
    };

    ReactDOM.render(<CardioSaludApp />, document.getElementById('root'));
</script>
</body>
</html>